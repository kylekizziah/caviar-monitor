<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Daily Caviar Digest ‚Äî {{ date }}</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; }
    .wrap { max-width:760px; margin:0 auto; padding:24px; }
    h1 { margin:0 0 12px; }
    .section { margin:24px 0; }
    table { width:100%; border-collapse:collapse; }
    th, td { border-bottom:1px solid #334155; padding:8px; text-align:left; font-size:14px;}
    th { color:#93c5fd; }
    a { color:#93c5fd; text-decoration:none; }
    .tag { font-size:12px; color:#94a3b8; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üêü Daily Caviar Digest ‚Äî {{ date }}</h1>
    <div class="tag">Cheapest options + market intel</div>

    <div class="section">
      <h2>üí∞ Cheapest Options (price/gram)</h2>
      {% if cheapest %}
      <table>
        <tr><th>Seller</th><th>Product</th><th>Size</th><th>Price</th><th>$/g</th><th>Link</th></tr>
        {% for p in cheapest %}
          <tr>
            <td>{{ p.site }}</td>
            <td>{{ p.name }}</td>
            <td>{{ p.size_label }}</td>
            <td>{{ p.currency }} {{ "%.2f"|format(p.price) }}</td>
            <td>{{ "%.2f"|format(p.per_g) }}</td>
            <td><a href="{{ p.url }}">View</a></td>
          </tr>
        {% endfor %}
      </table>
      {% else %}
        <p>No price data yet ‚Äî add seller URLs to <code>price_sites.yaml</code>.</p>
      {% endif %}
    </div>

    <div class="section">
      <h2>üìâ Notable Price Changes (24‚Äì72h)</h2>
      {% if movers %}
        <ul>
          {% for m in movers %}
            <li>{{ m.site }} ‚Äî <strong>{{ m.name }}</strong>: {{ m.delta_sign }}{{ "%.2f"|format(m.delta_abs) }} {{ m.currency }} ({{ m.delta_pct }}%) ‚Üí now {{ m.currency }} {{ "%.2f"|format(m.price) }} / {{ m.size_label }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No price changes detected in the last 72h.</p>
      {% endif %}
    </div>

    <div class="section">
      <h2>üì∞ Producer & Farm Updates (caviar-only)</h2>
      {% if news_items %}
        {% for it in news_items %}
          <div style="margin:12px 0;">
            <div class="tag">{{ it.category }}</div>
            <div><a href="{{ it.url }}"><strong>{{ it.title }}</strong></a></div>
            <div class="tag">{{ it.source }} ‚Äî {{ it.published_at }}</div>
            <div>{{ it.summary }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p>No new caviar-specific headlines.</p>
      {% endif %}
    </div>

    <div class="section" style="color:#94a3b8;font-size:12px;">
      Data gathered automatically; prices may change. Update seller list in <code>price_sites.yaml</code>.
    </div>
  </div>
</body>
</html>
