<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Daily Caviar Digest</title>
  <style>
    body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f7f7f9; color:#222; margin:0; padding:20px; }
    h1 { margin: 0 0 6px 0; }
    h2 { margin: 18px 0 8px 0; }
    .card { background:#fff; border:1px solid #eee; border-radius:8px; padding:14px; margin:10px 0; }
    table { width:100%; border-collapse: collapse; }
    th, td { padding:8px 10px; border-bottom:1px solid #eee; text-align:left; }
    th { background:#fafafa; font-size: 0.95em; }
    a { color:#0a5; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .muted { color:#666; font-size:12px; }
  </style>
</head>
<body>
  <h1>üêü Daily Caviar Digest ‚Äî {{ date }}</h1>
  <p>Cheapest verified sturgeon caviar options across trusted producers.</p>

  {% set any_items = false %}
  {% for bucket, items in top_picks.items() %}
    {% if items and items|length > 0 %}
      {% set any_items = true %}
      <div class="card">
        <h2>{{ bucket }}</h2>
        <table>
          <thead>
            <tr>
              <th>Vendor</th><th>Species / Grade</th><th>Size</th><th>Price</th><th>$ / g</th><th>Ship From</th><th>Link</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
            <tr>
              <td>{{ it.vendor }}</td>
              <td>{{ it.species }}{% if it.grade %} <span class="muted">({{ it.grade }})</span>{% endif %}</td>
              <td>{{ it.size_label }}</td>
              <td>{{ it.currency }} {{ "%.2f"|format(it.price) }}</td>
              <td>{{ "%.2f"|format(it.per_g) }}</td>
              <td>{{ it.origin_state or "US" }}</td>
              <td><a href="{{ it.url }}">View</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  {% endfor %}

  {% if not any_items %}
  <div class="card">
    No caviar listings with verified species found in this run.
  </div>
  {% endif %}

  <p class="muted">Data gathered automatically from verified producers &amp; farms. Prices may change. Edit <code>price_sites.yaml</code> to add/remove sellers.</p>
</body>
</html>
